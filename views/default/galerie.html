{{extend 'layout.html'}}

<div id="doi-doi">
	<div id="galerie">
		<div id="grid">
		{{for index,pic in enumerate(pics):}}
			{{=A(IMG(_src=URL('download', args=pic.gray), _alt=pic.title, _class='pic'), _href=URL('panou', args=(pic.id, index+1, len(pics))))}}
		{{pass}}
		</div>
		<div id="panou"></div>
	</div>
</div>

<div id="trei-patru">
	<div id="progress">
		<img src="{{=URL('static', 'images/progress.gif')}}" alt="progress"/>
	</div>
</div>

<div id="doi-cinci">
	<div id="navigator"><a id="prev-gallery" href=""></a><a id="next-gallery" href=""></a></div>
</div>

<script type="text/javascript">
	function updatePrevNext(aObject){
		var prevImage = aObject.prev("a").attr("href");
		var nextImage = aObject.next("a").attr("href");
		if(prevImage) {
			$("#prev-gallery").attr("href", prevImage);
			$("#prev-gallery").removeClass("disabled");
		} else {
			$("#prev-gallery").addClass("disabled");
		}
		if(nextImage){
			$("#next-gallery").attr("href", nextImage);
			$("#next-gallery").removeClass("disabled");
		} else {
			$("#next-gallery").addClass("disabled");
		}
	}
	function showActivity(){
		$("progress").show();
	}
	function hideActivity(){
		$("progress").hide();
	}
	
	function updateTip() {
		hideActivity();
				
		$('#poza-mare[title]').qtip({
			style: {name: 'dark'},
			position: {
	 			corner: {
 					target: 'bottomCenter',
 					tooltip: 'bottomLeft'
					}
				},
		});
	}
	$(function(){
		showActivity();
		var firstLink = $("#grid>a:first");
		$("#panou").load(firstLink.attr("href"), function(){
			updatePrevNext(firstLink);
			updateTip();
		});
		$('').insertAfter("#fancybox-close");

		$("#grid>a").click(function(e){
			showActivity();
			var clickedLink = $(this);
			updatePrevNext(clickedLink);
			$("#panou").load(clickedLink.attr("href"), function(){
				updateTip();
			});
			e.preventDefault();
		});
		$("#prev-gallery, #next-gallery").click(function(e){
			showActivity();
			var clickedLink = $(this);
			updatePrevNext($("#grid>a[href='"+clickedLink.attr("href")+"']"));
			$("#panou").load(clickedLink.attr("href"), function(){
				updateTip();
			});
			e.preventDefault();
		});
	});
</script>
