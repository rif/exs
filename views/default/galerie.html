<div id="galerie">
	<div id="grid">
	{{for index,pic in enumerate(pics):}}
		{{=A(IMG(_src=URL('download', args=pic.gray), _alt=pic.title, _class='pic'), _href=URL('panou', args=(pic.id, index+1, len(pics))))}}
	{{pass}}
	</div>
	<div id="panou">
	</div>
</div>

<script type="text/javascript">
	function updateProperties(aObject) {
		$("#poza-mare").load(function(){
			$.fancybox.hideActivity();
			var prevImage = aObject.prev("a").attr("href");
			var nextImage = aObject.next("a").attr("href");
			if(prevImage) {
				$("#prev-gallery").attr("href", prevImage);
				$("#prev-gallery").removeClass("disabled");
			} else {
				$("#prev-gallery").addClass("disabled");
			}
			if(nextImage){
				$("#next-gallery").attr("href", nextImage);
				$("#next-gallery").removeClass("disabled");
			} else {
				$("#next-gallery").addClass("disabled");
			}
		});
				
		$('#poza-mare[title]').qtip({
			style: {name: 'dark'},
			position: {
	 			corner: {
 					target: 'bottomCenter',
 					tooltip: 'bottomLeft'
					}
				},
		});
	}

	$(function(){
		$.fancybox.showActivity();
		var firstLink = $("#grid>a:first");
		$("#panou").load(firstLink.attr("href"), function(){
			updateProperties(firstLink);
		});
		$('<div id="navigator"><a id="prev-gallery" href=""></a><a id="next-gallery" href=""></a></div>').insertAfter("#fancybox-close");

		$("#grid>a").click(function(e){
			$.fancybox.showActivity();
			var clickedLink = $(this);
			$("#panou").load(clickedLink.attr("href"), function(){
				updateProperties(clickedLink);
			});
			e.preventDefault();
		});
		$("#prev-gallery, #next-gallery").click(function(e){
			$.fancybox.showActivity();
			var clickedLink = $(this);
			$("#panou").load(clickedLink.attr("href"), function(){
				console.log("#grid>a[href='"+clickedLink.attr("href")+"']");
				console.log($("#grid>a[href='"+clickedLink.attr("href")+"']"));
				updateProperties($("#grid>a[href='"+clickedLink.attr("href")+"']"));
			});
			e.preventDefault();
		});
	});
</script>
